<div data-controller="client-selector">
  <%= form_with(model: @campaign, local: true, id: 'campaign-form', data: { turbo: false }, html: { multipart: true }) do |form| %>
    <% if @campaign.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@campaign.errors.count, "error") %> prohibited this campaign from being saved:</h2>
        <ul>
          <% @campaign.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- Campaign Name Field -->
    <div class="form-group">
      <%= form.label :name %>
      <%= form.text_field :name, class: "form-control" %>
    </div>

    <!-- Campaign Start Date Field -->
    <div class="form-group">
      <%= form.label :start_date %>
      <%= form.date_field :start_date, class: "form-control" %>
    </div>

    <!-- Campaign End Date Field -->
    <div class="form-group">
      <%= form.label :end_date %>
      <%= form.date_field :end_date, class: "form-control" %>
    </div>

    <!-- Campaign Description Field -->
    <div class="form-group">
      <%= form.label :description %>
      <%= form.text_area :description, class: "form-control" %>
    </div>

    <% if current_staff.manager? %>
      <!-- Multiple Image Upload Field for Managers -->
      <div class="form-group">
        <%= form.label :images, "Upload Campaign Images" %>
        <%= form.file_field :images, multiple: true, class: "form-control" %>
      </div>
    <% end %>

    <!-- Assign Staff Field -->
    <div class="form-group">
      <%= form.label :staff_id, "Assign Staff" %>
      <%= form.collection_select :staff_id, Staff.all, :id, :name, prompt: "Select a staff member", class: "form-control", id: "campaign_staff_id", data: { action: "change->client-selector#loadClients", client_selector_target: "staffSelect" } %>
    </div>

    <!-- Select Segment Field -->
    <div class="form-group">
      <%= form.label :segment, "Select Segment" %>
      <select id="segment_select" class="form-control" data-action="change->client-selector#loadClients">
        <option value="">All Segments</option>
        <% Client::SEGMENTS.each do |segment| %>
          <option value="<%= segment.first %>"><%= segment.first.capitalize %></option>
        <% end %>
      </select>
    </div>

    <!-- Client Selection Container (Filled dynamically by JS) -->
    <div id="client-select-container" class="form-group" data-client-selector-target="clientsContainer">
      <%= render partial: "campaigns/client_list", locals: { clients: @clients } %>
    </div>

    <!-- Submit Button -->
    <%= form.submit "Save Campaign", class: "btn btn-primary" %>
  <% end %>
</div>

<style>
  /* General Form Styling */
form {
  background-color: #E5ECF6;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
  font-family: 'Montserrat', sans-serif;
  max-width: 600px;
  margin: 0 auto;
}

h2 {
  color: #7e94a7;
  font-weight: bold;
  text-align: center;
  margin-bottom: 15px;
}

/* Input Fields Styling */
.form-group {
  margin-bottom: 20px;
}

.form-control {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #e1e5e8;
  background-color: #fff;
  font-size: 16px;
  transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
}

.form-control:focus {
  border-color: #7e94a7;
  box-shadow: 0 0 5px rgba(126, 148, 167, 0.5);
  outline: none;
}

textarea.form-control {
  height: 150px;
}

/* Button Styling */
.btn-primary {
  background-color: #7e94a7;
  border: none;
  padding: 12px 20px;
  border-radius: 50px;
  font-size: 18px;
  text-transform: uppercase;
  color: #fff;
  cursor: pointer;
  transition: background-color 0.3s ease-in-out;
  display: block;
  width: 100%;
}

.btn-primary:hover {
  background-color: #abc9ec;
}

/* Error Messages Styling */
#error_explanation {
  background-color: #ffebee;
  color: #c62828;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 20px;
  border: 1px solid #f44336;
}

#error_explanation h2 {
  font-size: 18px;
  font-weight: bold;
}

#error_explanation ul {
  padding-left: 20px;
}

#error_explanation ul li {
  margin-bottom: 8px;
}

/* Labels Styling */
label {
  font-weight: bold;
  margin-bottom: 10px;
  display: block;
  color: #2c3e50;
}

/* Segment Selector Styling */
select.form-control {
  appearance: none;
  background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23333" d="M2 0L0 2h4zM2 5L0 3h4z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 10px;
  padding-right: 30px;
}

/* Client Container Styling */
#client-select-container {
  background-color: #eef1f7;
  border-radius: 10px;
  padding: 20px;
  border: 1px solid #dcdfe3;
}

/* Additional Styling */
body {
  background-color: #f1f3f6;
  color: #2c3e50;
  font-family: 'Montserrat', sans-serif;
}

#campaign-form {
  margin-top: 50px;
}

/* Hover Effects */
.form-group:hover label {
  color: #7e94a7;
}

.form-group input:hover,
.form-group textarea:hover,
.form-group select:hover {
  border-color: #7e94a7;
}

</style>